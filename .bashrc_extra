# === Connect to Tryo servers ===
function in_tryo () {
  local local_ip=`ifconfig en0 | grep "inet " | awk '{print $2}' | cut -c1-10`
  if [[ "$local_ip" == "192.168.11" ]]; then
    return 0;
  else
    return 1;
  fi
}

function dsaurus() {
  title dsaurus;
  if in_tryo; then
    ssh dsaurusl $1 -Y
  else
    ssh dsaurus $1 -Y
  fi
}

function bernie() {
  title bernie;
  if in_tryo; then
    ssh berniel $1 -Y
  else
    ssh bernie $1 -Y
  fi
}
# ===============================

alias gcloud="~/bin/google-cloud-sdk/bin/gcloud"
export NOTE_DIR=~/Dropbox/Notes
export CARD_DIR=~/Dropbox/Cards
export FEYNMAN_DIR=~/Dropbox/Feynman


# Memory card writing function and command completion
# Should at some point recicle the code of n() with a different folder argument
_c() {
  local lis cur
  lis=$(find "${CARD_DIR}" -name "*.md" | \
    sed -e "s|${CARD_DIR}/||" | \
    sed -e 's/\.md$//')
  cur=${COMP_WORDS[COMP_CWORD]}
  COMPREPLY=( $(compgen -W "$lis" -- "$cur") )
}
c() {
  : "${CARD_DIR:?'CARD_DIR ENV Var not set'}"
  if [ $# -eq 0 ]; then
    local file
    file=$(find "${CARD_DIR}" -name "*.md" | \
      sed -e "s|${CARD_DIR}/||" | \
      sed -e 's/\.md$//' | \
      fzf \
        --multi \
        --select-1 \
        --exit-0 \
        --preview="cat ${CARD_DIR}/{}.md" \
        --preview-window=right:70%:wrap)
    [[ -n $file ]] && \
      ${EDITOR:-vim} "${CARD_DIR}/${file}.md"
  else
    case "$1" in
      "-d")
        rm "${CARD_DIR}"/"$2".md
        ;;
      *)
        ${EDITOR:-vim} "${CARD_DIR}"/"$*".md
        ;;
    esac
  fi
}
complete -F _c c


# Feynman method writing function and command completion
# Should at some point recicle the code of n() with a different folder argument
_f() {
  local lis cur
  lis=$(find "${FEYNMAN_DIR}" -name "*.md" | \
    sed -e "s|${FEYNMAN_DIR}/||" | \
    sed -e 's/\.md$//')
  cur=${COMP_WORDS[COMP_CWORD]}
  COMPREPLY=( $(compgen -W "$lis" -- "$cur") )
}
f() {
  : "${FEYNMAN_DIR:?'FEYNMAN_DIR ENV Var not set'}"
  if [ $# -eq 0 ]; then
    local file
    file=$(find "${FEYNMAN_DIR}" -name "*.md" | \
      sed -e "s|${FEYNMAN_DIR}/||" | \
      sed -e 's/\.md$//' | \
      fzf \
        --multi \
        --select-1 \
        --exit-0 \
        --preview="cat ${FEYNMAN_DIR}/{}.md" \
        --preview-window=right:70%:wrap)
    [[ -n $file ]] && \
      ${EDITOR:-vim} "${FEYNMAN_DIR}/${file}.md"
  else
    case "$1" in
      "-d")
        rm "${FEYNMAN_DIR}"/"$2".md
        ;;
      *)
        ${EDITOR:-vim} "${FEYNMAN_DIR}"/"$*".md
        ;;
    esac
  fi
}
complete -F _f f
